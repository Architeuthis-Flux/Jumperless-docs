{% extends "base.html" %}

{% block site_meta %}
    {{ super() }}
    
    <!-- Open Graph / Facebook -->
    <meta property="og:type" content="website">
    <meta property="og:url" content="{{ config.site_url }}{% if page %}{{ page.url }}{% endif %}">
    <meta property="og:title" content="{% if page and page.title %}{{ page.title }} - {{ config.site_name }}{% else %}{{ config.site_name }}{% endif %}">
    <meta property="og:description" content="{% if page and page.meta and page.meta.description %}{{ page.meta.description }}{% elif config.site_description %}{{ config.site_description }}{% else %}Learn how to use your Jumperless{% endif %}">
    <meta property="og:image" content="{{ config.site_url }}assets/ExplodraftWords.png">
    <meta property="og:image:alt" content="Jumperless Logo">
    <meta property="og:site_name" content="{{ config.site_name }}">
    
    <!-- Twitter -->
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:url" content="{{ config.site_url }}{% if page %}{{ page.url }}{% endif %}">
    <meta name="twitter:title" content="{% if page and page.title %}{{ page.title }} - {{ config.site_name }}{% else %}{{ config.site_name }}{% endif %}">
    <meta name="twitter:description" content="{% if page and page.meta and page.meta.description %}{{ page.meta.description }}{% elif config.site_description %}{{ config.site_description }}{% else %}Learn how to use your Jumperless{% endif %}">
    <meta name="twitter:image" content="{{ config.site_url }}assets/ExplodraftWords.png">
    <meta name="twitter:image:alt" content="Jumperless Logo">
    
    <!-- Additional SEO Meta Tags -->
    <meta name="description" content="{% if page and page.meta and page.meta.description %}{{ page.meta.description }}{% elif config.site_description %}{{ config.site_description }}{% else %}Learn how to use your Jumperless{% endif %}">
    <meta name="keywords" content="jumperless, breadboard, electronics, prototyping, documentation{% if page and page.meta and page.meta.keywords %}, {{ page.meta.keywords }}{% endif %}">
    <meta name="author" content="Kevin Santo Cappuccio">
    <meta name="robots" content="index, follow">
    
    <!-- Canonical URL -->
    <link rel="canonical" href="{{ config.site_url }}{% if page %}{{ page.url }}{% endif %}">
    
    <!-- LLM-friendly documentation (llms.txt spec) -->
    <link rel="llms-txt" href="{{ config.site_url }}llms.txt" title="LLM documentation index">
    <link rel="llms-full-txt" href="{{ config.site_url }}llms-full.txt" title="Complete documentation for LLMs">
    
    <!-- Theme Color -->
    <meta name="theme-color" content="#ff4775">
    <meta name="msapplication-TileColor" content="#ff47A5">
{% endblock %}

{% block extrahead %}
    {{ super() }}
    <style>
      /* Hide prev/next at bottom of content area */
      .rst-footer-buttons { display: none !important; }
      /* Hide prev/next nav at bottom of sidebar (rst-versions strip) */
      .rst-versions { display: none !important; }
    </style>
{% endblock %}

{# Override the libs block to prevent highlight.js from loading #}
{% block libs %}{% endblock %}

{# Override any highlight.js scripts #}
{% block scripts %}
    <!-- Load everything except highlight.js -->
    <script src="{{ 'js/jquery-3.6.0.min.js'|url }}"></script>
    <script>var base_url = {{ base_url|tojson }};</script>
    <script src="{{ 'js/theme_extra.js'|url }}"></script>
    <script src="{{ 'js/theme.js'|url }}"></script>
    {%- for script in config.extra_javascript %}
        {{ script|script_tag }}
    {%- endfor %}
    <script>
        jQuery(function () {
            SphinxRtdTheme.Navigation.enable({{ 'true' if config.theme.sticky_navigation else 'false' }});
        });
    </script>
    <!-- Android mobile: ensure hamburger opens nav when touch doesn't synthesize click -->
    <script>
        (function() {
            function toggleNav() {
                var shift = document.querySelectorAll("[data-toggle='wy-nav-shift']");
                var versions = document.querySelectorAll("[data-toggle='rst-versions']");
                for (var i = 0; i < shift.length; i++) shift[i].classList.toggle("shift");
                for (var j = 0; j < versions.length; j++) versions[j].classList.toggle("shift");
            }
            function handleNavTap(e) {
                var t = e.changedTouches && e.changedTouches[0];
                if (t && e.currentTarget === e.target.closest("nav.wy-nav-top")) {
                    var x = t.clientX;
                    var rect = e.currentTarget.getBoundingClientRect();
                    if (x < rect.left + 70) {
                        toggleNav();
                        e.preventDefault();
                        e.stopPropagation();
                    }
                }
            }
            document.addEventListener("DOMContentLoaded", function() {
                var icon = document.querySelector("nav.wy-nav-top i[data-toggle='wy-nav-top']");
                var nav = document.querySelector("nav.wy-nav-top");
                if (!icon && !nav) return;
                function onTouchEnd(e) {
                    toggleNav();
                    e.preventDefault();
                    e.stopPropagation();
                }
                if (icon) {
                    icon.addEventListener("touchend", onTouchEnd, { passive: false });
                }
                if (nav) {
                    nav.addEventListener("touchend", handleNavTap, { passive: false });
                }
                // Replace JumperIDE sidebar link text with logo image
                var ideLink = document.querySelector(".wy-menu a[href*='ide.jumperless.org']");
                if (ideLink) {
                    var base = (typeof base_url === "string" && base_url) ? base_url.replace(/\/?$/, "") + "/" : "";
                    var img = document.createElement("img");
                    img.src = base + "assets/ColorBubbleLogoIDE@0.25x.png";
                    img.alt = "JumperIDE";
                    img.className = "sidebar-ide-logo";
                    img.style.maxWidth = "70%";
                    img.style.maxHeight = "40px";
                    img.style.width = "auto";
                    img.style.height = "auto";
                    img.style.objectFit = "contain";
                    img.style.display = "block";
                    ideLink.textContent = "";
                    ideLink.appendChild(img);
                }
            });
        })();
    </script>
    <!-- JumperIDE: scroll to anchor or search page when embedded in iframe (postMessage from ide.jumperless.org) -->
    <script>
        (function() {
            var ALLOWED_ORIGINS = ["https://ide.jumperless.org", "http://localhost:5173", "http://127.0.0.1:5173"];
            function scrollToAnchor(anchor) {
                if (!anchor || typeof anchor !== "string") return;
                var el = document.getElementById(anchor);
                if (el) {
                    el.scrollIntoView({ behavior: "smooth", block: "start" });
                    try { window.history.replaceState(null, "", "#" + anchor); } catch (e) {}
                }
            }
            function scrollToSearchText(searchText) {
                if (!searchText || typeof searchText !== "string") return;
                var needle = searchText.toLowerCase().trim();
                if (!needle) return;
                var candidates = document.querySelectorAll("h1, h2, h3, h4, h5, h6, dt, .sig, .descname, code");
                for (var i = 0; i < candidates.length; i++) {
                    var el = candidates[i];
                    var text = (el.textContent || "").trim();
                    if (!text) continue;
                    if (text.toLowerCase().indexOf(needle) !== -1) {
                        el.scrollIntoView({ behavior: "smooth", block: "start" });
                        return;
                    }
                }
                var walker = document.createTreeWalker(document.body, NodeFilter.SHOW_TEXT, null, false);
                var node;
                while ((node = walker.nextNode())) {
                    if (node.textContent.toLowerCase().indexOf(needle) !== -1) {
                        var block = node.parentElement;
                        while (block && !/^(h[1-6]|section|article|div|p|dt|li|td)$/i.test(block.tagName)) block = block.parentElement;
                        if (block) {
                            block.scrollIntoView({ behavior: "smooth", block: "start" });
                            return;
                        }
                    }
                }
            }
            window.addEventListener("message", function(e) {
                if (ALLOWED_ORIGINS.indexOf(e.origin) === -1) return;
                if (!e.data || e.data.type !== "jumperide-scroll-to") return;
                if (e.data.anchor) {
                    scrollToAnchor(e.data.anchor);
                } else if (e.data.searchText) {
                    scrollToSearchText(e.data.searchText);
                }
            });
            document.addEventListener("DOMContentLoaded", function() {
                var hash = (window.location.hash || "").replace(/^#/, "");
                if (hash) scrollToAnchor(hash);
            });
        })();
    </script>
{% endblock %} 